<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="集群运行nfsiostat收集信息并分析" /><meta property="og:locale" content="en" /><meta name="description" content="工作中偶遇到NFS Server中IO hang，这里提供一个在集群中批量运行nfsiostat命令，并收集信息保存至excel文件，按nfs server分sheet，锁定第一行，并对每一列汇总。" /><meta property="og:description" content="工作中偶遇到NFS Server中IO hang，这里提供一个在集群中批量运行nfsiostat命令，并收集信息保存至excel文件，按nfs server分sheet，锁定第一行，并对每一列汇总。" /><link rel="canonical" href="https://icinfra.cn/posts/cluster-nfsiostat/" /><meta property="og:url" content="https://icinfra.cn/posts/cluster-nfsiostat/" /><meta property="og:site_name" content="IC Infra" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-03-17T12:25:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="集群运行nfsiostat收集信息并分析" /><meta name="twitter:site" content="@username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-03-17T12:25:00+00:00","datePublished":"2024-03-17T12:25:00+00:00","description":"工作中偶遇到NFS Server中IO hang，这里提供一个在集群中批量运行nfsiostat命令，并收集信息保存至excel文件，按nfs server分sheet，锁定第一行，并对每一列汇总。","headline":"集群运行nfsiostat收集信息并分析","mainEntityOfPage":{"@type":"WebPage","@id":"https://icinfra.cn/posts/cluster-nfsiostat/"},"url":"https://icinfra.cn/posts/cluster-nfsiostat/"}</script><title>集群运行nfsiostat收集信息并分析 | IC Infra</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="IC Infra"><meta name="application-name" content="IC Infra"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://cdn.jsdelivr.net/gh/icinfra/icinfra-artifacts-0001@artifacts/img/avatar.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">IC Infra</a><p class="site-subtitle fst-italic mb-0">Focused on building and optimizing stable and efficient IC design infrastructure, offering in-depth insights into cutting-edge tools, workflows, and automation techniques. Feel free to contact me.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/discussions/" class="nav-link"> <i class="fa-fw fas fa-comments"></i> <span>DISCUSSIONS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/wanlinwang" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['wanlin.wang','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>集群运行nfsiostat收集信息并分析</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="false"><header><h1 data-toc-skip>集群运行nfsiostat收集信息并分析</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1710678300" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Mar 17, 2024 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/wanlinwang">wanlinwang</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="886 words" > <em>4 min</em> read</span></div></div></div></header><div class="content"><p>工作中偶遇到NFS Server中IO hang，这里提供一个在集群中批量运行nfsiostat命令，并收集信息保存至excel文件，按nfs server分sheet，锁定第一行，并对每一列汇总。</p><p>也可以进一步定制，定期将数据推送至ElasticSearch，记录时序数据以做进一步分析。</p><div class="language-python highlighter-rouge"><div class="code-header"> <span data-label-text="Python"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
</pre><td class="rouge-code"><pre><span class="c1"># wanlinwang
# 2024-03-17
</span>
<span class="kn">import</span> <span class="n">re</span>
<span class="kn">import</span> <span class="n">paramiko</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="n">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="n">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span>

<span class="c1"># fs to mountpoint
</span><span class="n">fs2mp</span> <span class="o">=</span> <span class="p">{</span>
<span class="sh">"</span><span class="s">192.168.10.1:/nfs001</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">home</span><span class="sh">"</span><span class="p">,</span>
<span class="sh">"</span><span class="s">192.168.10.1:/nfs002</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">tools</span><span class="sh">"</span><span class="p">,</span>
<span class="sh">"</span><span class="s">192.168.10.2:/nfs003</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">proj</span><span class="sh">"</span><span class="p">,</span>

<span class="c1"># Server information list
</span><span class="n">servers</span> <span class="o">=</span> <span class="p">[</span>
<span class="sh">"</span><span class="s">192.168.10.1</span><span class="sh">"</span><span class="p">,</span>
<span class="sh">"</span><span class="s">192.168.10.2</span><span class="sh">"</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">ops_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="sh">'</span><span class="s">\b[\d.]+(?: \([\d.]+\))?|\d+ \(.*?\)</span><span class="sh">'</span>

<span class="c1"># Execute nfsiostat and get the results
</span><span class="k">def</span> <span class="nf">get_nfsiostat</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="sh">"</span><span class="s">root</span><span class="sh">"</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">paramiko</span><span class="p">.</span><span class="nc">SSHClient</span><span class="p">()</span>
    <span class="n">client</span><span class="p">.</span><span class="nf">set_missing_host_key_policy</span><span class="p">(</span><span class="n">paramiko</span><span class="p">.</span><span class="nc">AutoAddPolicy</span><span class="p">())</span>
    <span class="n">client</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">hostname</span><span class="o">=</span><span class="n">host</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">36000</span><span class="p">)</span>
    <span class="n">stdin</span><span class="p">,</span> <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">exec_command</span><span class="p">(</span><span class="sh">'</span><span class="s">nfsiostat 2 2</span><span class="sh">'</span><span class="p">)</span>

    <span class="c1"># 等待第一次报告的输出并忽略
</span>    <span class="k">while</span> <span class="ow">not</span> <span class="n">stdout</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="nf">recv_ready</span><span class="p">():</span>
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># 轮询等待输出
</span>    <span class="n">first_output</span> <span class="o">=</span> <span class="n">stdout</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1000000</span><span class="p">)</span>  <span class="c1"># 读取并丢弃第一次输出
</span>    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s"> 接收到第一次数据。</span><span class="sh">"</span><span class="p">)</span>
    <span class="c1">#print(first_output.decode())
</span>
    <span class="c1"># 等待并读取第二次结果
</span>    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># 接收第二次
</span>    <span class="n">output</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">""</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">stdout</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="n">eof_received</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">stdout</span><span class="p">.</span><span class="n">channel</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">output</span> <span class="o">+=</span> <span class="n">chunk</span>
        <span class="k">except</span> <span class="n">Eception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">接收第二次时发生错误</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s"> 第二次结果</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">output</span><span class="p">.</span><span class="nf">decode</span><span class="p">()</span>
    <span class="c1">#print(f"output {output}")
</span>    <span class="n">client</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">output</span>

<span class="c1"># Parse nfsiostat output
</span><span class="k">def</span> <span class="nf">parse_nfsiostat_output</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">output</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">output_io</span> <span class="o">=</span> <span class="nc">StringIO</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">output_io</span><span class="p">.</span><span class="nf">readlines</span><span class="p">()</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span> <span class="k">if</span> <span class="n">line</span><span class="p">.</span><span class="nf">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="sh">""</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nf">len</span><span class="p">(</span><span class="n">lines</span><span class="p">),</span> <span class="mi">7</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">5</span> <span class="o">&lt;</span> <span class="nf">len</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="c1">#mount_point = "/".join(lines[i].strip().split("/")[0:2])
</span>            <span class="n">mount_point</span> <span class="o">=</span> <span class="sh">"</span><span class="s">/</span><span class="sh">"</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">re</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">/| </span><span class="sh">'</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">strip</span><span class="p">())[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">ops_rpc</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">].</span><span class="nf">strip</span><span class="p">().</span><span class="nf">split</span><span class="p">()</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">ops_pattern</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
            <span class="n">read_ops</span> <span class="o">=</span> <span class="p">[</span><span class="nf">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">if</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">num</span> <span class="k">else</span> <span class="nf">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
            <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="p">.</span><span class="nf">findall</span><span class="p">(</span><span class="n">ops_pattern</span><span class="p">,</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">])</span>
            <span class="n">write_ops</span> <span class="o">=</span> <span class="p">[</span><span class="nf">float</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">if</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">num</span> <span class="k">else</span> <span class="nf">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
            <span class="n">data</span><span class="p">.</span><span class="nf">append</span><span class="p">({</span>
                <span class="sh">"</span><span class="s">server</span><span class="sh">"</span><span class="p">:</span> <span class="n">server</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">mount_point</span><span class="sh">"</span><span class="p">:</span> <span class="n">mount_point</span><span class="p">,</span>
                <span class="sh">"</span><span class="s">op/s</span><span class="sh">"</span><span class="p">:</span> <span class="n">ops_rpc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">rpc bklog</span><span class="sh">"</span><span class="p">:</span> <span class="n">ops_rpc</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">read_ops/s</span><span class="sh">"</span><span class="p">:</span> <span class="n">read_ops</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sh">"</span><span class="s">read_kB/s</span><span class="sh">"</span><span class="p">:</span> <span class="n">read_ops</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sh">"</span><span class="s">read_kB/op</span><span class="sh">"</span><span class="p">:</span> <span class="n">read_ops</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">read_retrans</span><span class="sh">"</span><span class="p">:</span> <span class="n">read_ops</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="sh">"</span><span class="s">read_retrans%</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">read_ops</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">read_avg RTT(ms)</span><span class="sh">"</span><span class="p">:</span> <span class="n">read_ops</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="sh">"</span><span class="s">read_avg exe(ms)</span><span class="sh">"</span><span class="p">:</span> <span class="n">read_ops</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">write_ops/s</span><span class="sh">"</span><span class="p">:</span> <span class="n">write_ops</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sh">"</span><span class="s">write_kB/s</span><span class="sh">"</span><span class="p">:</span> <span class="n">write_ops</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sh">"</span><span class="s">write_kB/op</span><span class="sh">"</span><span class="p">:</span> <span class="n">write_ops</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                <span class="sh">"</span><span class="s">write_retrans</span><span class="sh">"</span><span class="p">:</span> <span class="n">write_ops</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="sh">"</span><span class="s">write_retrans%</span><span class="sh">"</span><span class="p">:</span> <span class="nf">str</span><span class="p">(</span><span class="n">write_ops</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="o">+</span> <span class="sh">"</span><span class="s">%</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">write_avg RTT(ms)</span><span class="sh">"</span><span class="p">:</span> <span class="n">write_ops</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="sh">"</span><span class="s">write_avg exe(ms)</span><span class="sh">"</span><span class="p">:</span> <span class="n">write_ops</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="p">})</span>
    <span class="k">return</span> <span class="n">data</span>

<span class="c1"># Function to fetch and parse nfsiostat output for a single server
</span><span class="k">def</span> <span class="nf">fetch_and_parse_nfsiostat</span><span class="p">(</span><span class="n">server</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="nf">get_nfsiostat</span><span class="p">(</span><span class="n">server</span><span class="p">)</span>
    <span class="k">return</span> <span class="nf">parse_nfsiostat_output</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">output</span><span class="p">)</span>

<span class="c1"># Main program using ThreadPoolExecutor for concurrency
</span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="nc">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">servers</span><span class="p">))</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">futures</span> <span class="o">=</span> <span class="p">[</span><span class="n">executor</span><span class="p">.</span><span class="nf">submit</span><span class="p">(</span><span class="n">fetch_and_parse_nfsiostat</span><span class="p">,</span> <span class="n">server</span><span class="p">)</span> <span class="k">for</span> <span class="n">server</span> <span class="ow">in</span> <span class="n">servers</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">futures</span><span class="p">:</span>
            <span class="n">all_data</span><span class="p">.</span><span class="nf">extend</span><span class="p">(</span><span class="n">future</span><span class="p">.</span><span class="nf">result</span><span class="p">())</span>
    
    <span class="c1"># Convert data to DataFrame for easier processing
</span>    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
    
    <span class="c1"># Removing duplicates, keeping only unique records
</span>    <span class="n">df_unique</span> <span class="o">=</span> <span class="n">df</span><span class="p">.</span><span class="nf">drop_duplicates</span><span class="p">()</span>

    <span class="c1"># Output to Excel file with different mount_points on different sheets
</span>    <span class="c1"># Generating the Excel file name with a timestamp
</span>    <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d_%H-%M-%S</span><span class="sh">"</span><span class="p">)</span>
    <span class="n">excel_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">nfsiostat_data_</span><span class="si">{</span><span class="n">current_time</span><span class="si">}</span><span class="s">.xlsx</span><span class="sh">"</span>

    <span class="k">with</span> <span class="n">pd</span><span class="p">.</span><span class="nc">ExcelWriter</span><span class="p">(</span><span class="n">excel_filename</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="sh">'</span><span class="s">xlsxwriter</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
        <span class="n">workbook</span> <span class="o">=</span> <span class="n">writer</span><span class="p">.</span><span class="n">book</span>
        <span class="k">for</span> <span class="n">mount_point</span> <span class="ow">in</span> <span class="n">df_unique</span><span class="p">[</span><span class="sh">'</span><span class="s">mount_point</span><span class="sh">'</span><span class="p">].</span><span class="nf">unique</span><span class="p">():</span>
            <span class="n">df_mp</span> <span class="o">=</span> <span class="n">df_unique</span><span class="p">[</span><span class="n">df_unique</span><span class="p">[</span><span class="sh">'</span><span class="s">mount_point</span><span class="sh">'</span><span class="p">]</span> <span class="o">==</span> <span class="n">mount_point</span><span class="p">]</span>

            <span class="c1"># 对每个server保留op/s最高的记录
</span>            <span class="n">df_mp</span> <span class="o">=</span> <span class="n">df_mp</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="sh">'</span><span class="s">op/s</span><span class="sh">'</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="bp">False</span><span class="p">).</span><span class="nf">drop_duplicates</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">server</span><span class="sh">'</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="sh">'</span><span class="s">first</span><span class="sh">'</span><span class="p">)</span>

            <span class="c1"># 对指定列进行降序排序
</span>            <span class="k">if</span> <span class="sh">'</span><span class="s">write_kB/s</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">df_mp</span><span class="p">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="sh">'</span><span class="s">read_kB/s</span><span class="sh">'</span> <span class="ow">in</span> <span class="n">df_mp</span><span class="p">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df_mp</span> <span class="o">=</span> <span class="n">df_mp</span><span class="p">.</span><span class="nf">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">write_kB/s</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">read_kB/s</span><span class="sh">'</span><span class="p">],</span> <span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">])</span>
            
            <span class="c1"># 创建工作表并写入数据
</span>            <span class="k">if</span> <span class="n">mount_point</span> <span class="ow">in</span> <span class="n">fs2mp</span><span class="p">:</span>
                <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">fs2mp</span><span class="p">[</span><span class="n">mount_point</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sheet_name</span> <span class="o">=</span> <span class="n">mount_point</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">:/</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">_</span><span class="sh">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">31</span><span class="p">]</span>
            <span class="n">df_mp</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            
            <span class="c1"># 获取工作表对象
</span>            <span class="n">worksheet</span> <span class="o">=</span> <span class="n">writer</span><span class="p">.</span><span class="n">sheets</span><span class="p">[</span><span class="n">sheet_name</span><span class="p">]</span>
            
            <span class="c1"># 锁定第一行
</span>            <span class="n">worksheet</span><span class="p">.</span><span class="nf">freeze_panes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

            <span class="c1"># 自动调整列宽
</span>            <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df_mp</span><span class="p">:</span>
                <span class="n">column_length</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">df_mp</span><span class="p">[</span><span class="n">column</span><span class="p">].</span><span class="nf">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">).</span><span class="nf">map</span><span class="p">(</span><span class="nb">len</span><span class="p">).</span><span class="nf">max</span><span class="p">(),</span> <span class="nf">len</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
                <span class="n">col_idx</span> <span class="o">=</span> <span class="n">df_mp</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nf">get_loc</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
                <span class="n">worksheet</span><span class="p">.</span><span class="nf">set_column</span><span class="p">(</span><span class="n">col_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">,</span> <span class="n">column_length</span><span class="p">)</span>
            
            <span class="c1"># Identify numeric columns and exclude specific ones from sum calculation
</span>            <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">df_mp</span><span class="p">.</span><span class="nf">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">number</span><span class="sh">'</span><span class="p">]).</span><span class="n">columns</span>
            <span class="n">numeric_cols</span> <span class="o">=</span> <span class="n">numeric_cols</span><span class="p">.</span><span class="nf">drop</span><span class="p">([</span><span class="sh">'</span><span class="s">read_avg RTT(ms)</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">read_avg exe(ms)</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">write_avg RTT(ms)</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">write_avg exe(ms)</span><span class="sh">'</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">)</span>  <span class="c1"># Exclude specific columns
</span>            <span class="n">sum_row</span> <span class="o">=</span> <span class="n">df_mp</span><span class="p">[</span><span class="n">numeric_cols</span><span class="p">].</span><span class="nf">sum</span><span class="p">().</span><span class="nf">to_dict</span><span class="p">()</span>
            <span class="n">sum_row</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">sum_row</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="sh">''</span><span class="p">)</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">df_mp</span><span class="p">.</span><span class="n">columns</span><span class="p">}</span>  <span class="c1"># Include empty values for non-numeric columns
</span>            <span class="n">df_sum</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([</span><span class="n">sum_row</span><span class="p">])</span>
            <span class="n">startrow</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">df_mp</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">df_sum</span><span class="p">.</span><span class="nf">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="n">sheet_name</span><span class="p">,</span> <span class="n">startrow</span><span class="o">=</span><span class="n">startrow</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            
            <span class="c1"># Format the sum row
</span>            <span class="n">sum_format</span> <span class="o">=</span> <span class="n">workbook</span><span class="p">.</span><span class="nf">add_format</span><span class="p">({</span><span class="sh">'</span><span class="s">bold</span><span class="sh">'</span><span class="p">:</span> <span class="bp">True</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">col_num</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">df_sum</span><span class="p">.</span><span class="n">columns</span><span class="p">):</span>
                <span class="n">worksheet</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">startrow</span><span class="p">,</span> <span class="n">col_num</span><span class="p">,</span> <span class="n">sum_row</span><span class="p">[</span><span class="n">value</span><span class="p">],</span> <span class="n">sum_format</span><span class="p">)</span>
    
    <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Data has been outputted to Excel file at </span><span class="si">{</span><span class="n">excel_filename</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="sh">"</span><span class="s">__main__</span><span class="sh">"</span><span class="p">:</span>
    <span class="nf">main</span><span class="p">()</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/icenv/">icenv</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/storage/" class="post-tag no-text-decoration" >storage</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E9%9B%86%E7%BE%A4%E8%BF%90%E8%A1%8Cnfsiostat%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF%E5%B9%B6%E5%88%86%E6%9E%90%20-%20IC%20Infra&url=https%3A%2F%2Ficinfra.cn%2Fposts%2Fcluster-nfsiostat%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E9%9B%86%E7%BE%A4%E8%BF%90%E8%A1%8Cnfsiostat%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF%E5%B9%B6%E5%88%86%E6%9E%90%20-%20IC%20Infra&u=https%3A%2F%2Ficinfra.cn%2Fposts%2Fcluster-nfsiostat%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ficinfra.cn%2Fposts%2Fcluster-nfsiostat%2F&text=%E9%9B%86%E7%BE%A4%E8%BF%90%E8%A1%8Cnfsiostat%E6%94%B6%E9%9B%86%E4%BF%A1%E6%81%AF%E5%B9%B6%E5%88%86%E6%9E%90%20-%20IC%20Infra" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div><div class="payment-info mt-5 text-center"><h4>支持创作者</h4><p>如果本文帮助到你，可以通过以下收款码支持我：</p><a href="https://cdn.jsdelivr.net/gh/icinfra/icinfra-artifacts-0001@artifacts/img/qrcode.jpg" class="popup img-link img-fluid shimmer"><img src="https://cdn.jsdelivr.net/gh/icinfra/icinfra-artifacts-0001@artifacts/img/qrcode.jpg" alt="收款码" style="max-width: 300px;" loading="lazy"></a><p>感谢你的支持！</p></div></div></article><script src="https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js"></script> <script> document.addEventListener('DOMContentLoaded', function() { mermaid.initialize({ startOnLoad: true, theme: "default" }); // 既支持 language-mermaid 也支持 mermaid 类 window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid, .mermaid')); }); </script></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/toggle-layers-visibility/">Toggle Layers Visibility</a><li class="text-truncate lh-lg"> <a href="/posts/cadence-eda-downloader-user-guide/">Cadence EDA Downloader User Guide </a><li class="text-truncate lh-lg"> <a href="/posts/privacy-policy-for-cadence-eda-downloader/">Privacy Policy for Cadence EDA Downloader</a><li class="text-truncate lh-lg"> <a href="/posts/cadence-support-downloader-privacy-policy/">Cadence Support Downloader: Privacy Policy</a><li class="text-truncate lh-lg"> <a href="/posts/Lumerical-job-scheduler-integration-Slurm-Torque-LSF-SGE/">Lumerical job scheduler integration (Slurm, Torque, LSF, SGE) </a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/formatting/">formatting</a> <a class="post-tag btn btn-outline-primary" href="/tags/post/">post</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/analog/">analog</a> <a class="post-tag btn btn-outline-primary" href="/tags/ipa/">ipa</a> <a class="post-tag btn btn-outline-primary" href="/tags/links/">links</a> <a class="post-tag btn btn-outline-primary" href="/tags/lsf/">lsf</a> <a class="post-tag btn btn-outline-primary" href="/tags/eda/">eda</a> <a class="post-tag btn btn-outline-primary" href="/tags/license/">license</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/ontap-simulator/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1720939200" data-df="ll" > Jul 14, 2024 </time><h4 class="pt-0 my-2">ontap模拟器</h4><div class="text-muted"><p>一、下载模拟器 参考《Simulate_ONTAP_9-14-1_Installation_and_Setup_Guide.pdf》P4的指导，登录网站进行下载。 二、传入pve，并解压转换 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 # 解压 tar -xvf vsim-netapp-DOT9.14.1-cm_nodar.ova # 解压后的文...</p></div></div></a></article><article class="col"> <a href="/posts/iops/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1710304200" data-df="ll" > Mar 13, 2024 </time><h4 class="pt-0 my-2">What is IOPs</h4><div class="text-muted"><p>我们经常会听到文件系统的IOPs，它是input/output Operations Per Second的缩写，它通常用于衡量文件系统的性能。对于读写操作，它通常是以n字节为单位的： 有时候它被称为operation or block size 一个1MB的文件以256个4KB块的读取，也可以以16个64KB块的读取：如果是4KB的块则产生256 IOPs，如果是64KB的块则产...</p></div></div></a></article><article class="col"> <a href="/posts/chatgpr-improve-memory/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1744300800" data-df="ll" > Apr 10, 2025 </time><h4 class="pt-0 my-2">ChatGPT improve memory</h4><div class="text-muted"><p></p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/time-to-read-or-write-in-spin-disk/" class="btn btn-outline-primary" aria-label="Older" ><p>time to read/write in spin disk</p></a> <a href="/posts/svn-ignore/" class="btn btn-outline-primary" aria-label="Newer" ><p>svn ignore设置</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/wanlinwang">wanlinwang</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Rights reserved.</span></p><p></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/formatting/">formatting</a> <a class="post-tag btn btn-outline-primary" href="/tags/post/">post</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/analog/">analog</a> <a class="post-tag btn btn-outline-primary" href="/tags/ipa/">ipa</a> <a class="post-tag btn btn-outline-primary" href="/tags/links/">links</a> <a class="post-tag btn btn-outline-primary" href="/tags/lsf/">lsf</a> <a class="post-tag btn btn-outline-primary" href="/tags/eda/">eda</a> <a class="post-tag btn btn-outline-primary" href="/tags/license/">license</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'icinfra/icinfra-discussions', 'data-repo-id': 'R_kgDOOURp_w', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOOURp_84Coy9P', 'data-mapping': 'pathname', 'data-strict' : '1', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
