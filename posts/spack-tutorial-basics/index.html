<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Spack教程（基础）" /><meta property="og:locale" content="en" /><meta name="description" content="准备 注：本教程均在Ubuntu:20.04镜像下演示。获取镜像并运行，" /><meta property="og:description" content="准备 注：本教程均在Ubuntu:20.04镜像下演示。获取镜像并运行，" /><link rel="canonical" href="https://icinfra.cn/posts/spack-tutorial-basics/" /><meta property="og:url" content="https://icinfra.cn/posts/spack-tutorial-basics/" /><meta property="og:site_name" content="IC Infra" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-11-07T02:42:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Spack教程（基础）" /><meta name="twitter:site" content="@username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-11-07T02:42:00+00:00","datePublished":"2022-11-07T02:42:00+00:00","description":"准备 注：本教程均在Ubuntu:20.04镜像下演示。获取镜像并运行，","headline":"Spack教程（基础）","mainEntityOfPage":{"@type":"WebPage","@id":"https://icinfra.cn/posts/spack-tutorial-basics/"},"url":"https://icinfra.cn/posts/spack-tutorial-basics/"}</script><title>Spack教程（基础） | IC Infra</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="IC Infra"><meta name="application-name" content="IC Infra"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="https://cdn.jsdelivr.net/gh/icinfra/icinfra-artifacts-0001@artifacts/img/avatar.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">IC Infra</a><p class="site-subtitle fst-italic mb-0">Focused on building and optimizing stable and efficient IC design infrastructure, offering in-depth insights into cutting-edge tools, workflows, and automation techniques. Feel free to contact me.</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/discussions/" class="nav-link"> <i class="fa-fw fas fa-comments"></i> <span>DISCUSSIONS</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/wanlinwang" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['wanlin.wang','foxmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Spack教程（基础）</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="false"><header><h1 data-toc-skip>Spack教程（基础）</h1><div class="post-meta text-muted"> <span> Posted <time data-ts="1667788920" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Nov 7, 2022 </time> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/wanlinwang">wanlinwang</a> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1892 words" > <em>10 min</em> read</span></div></div></div></header><div class="content"><h1 id="准备">准备</h1><p>注：本教程均在Ubuntu:20.04镜像下演示。获取镜像并运行，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="o">[</span>wanlinwang@VM-119-18-tencentos ~]<span class="nv">$ </span>docker pull ubuntu:22.04
22.04: Pulling from library/ubuntu
aece8493d397: Pull <span class="nb">complete 
</span>Digest: sha256:2b7412e6465c3c7fc5bb21d3e6f1917c167358449fecac8176c6e496e5c1f05f
Status: Downloaded newer image <span class="k">for </span>ubuntu:22.04
docker.io/library/ubuntu:22.04
<span class="o">[</span>wanlinwang@VM-119-18-tencentos ~]<span class="nv">$ </span>docker run <span class="nt">-ti</span> ubuntu:22.04
root@284b243a39ec:/# <span class="nb">cd
</span>root@284b243a39ec:~#
</pre></table></code></div></div><p>安装相关依赖包（其中git用来与git仓库交互，python3用作spack的解析器，gcc gfortran fort77 g++ clang用作spack构建工具时的编译器，make构建），</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>root@284b243a39ec:~# apt update
root@284b243a39ec:~# apt <span class="nb">install </span>git python3
root@284b243a39ec:~# apt <span class="nb">install </span>gcc gfortran fort77 g++ clang
root@284b243a39ec:~# apt <span class="nb">install </span>make
</pre></table></code></div></div><p>下载spack，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>root@284b243a39ec:~# git clone <span class="nt">--depth</span><span class="o">=</span>100 <span class="nt">--branch</span><span class="o">=</span>releases/v0.20 https://github.com/spack/spack.git ~/spack
Cloning into <span class="s1">'/root/spack'</span>...
remote: Enumerating objects: 19032, <span class="k">done</span><span class="nb">.</span>
remote: Counting objects: 100% <span class="o">(</span>19032/19032<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Compressing objects: 100% <span class="o">(</span>10494/10494<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Total 19032 <span class="o">(</span>delta 2022<span class="o">)</span>, reused 12091 <span class="o">(</span>delta 1506<span class="o">)</span>, pack-reused 0
Receiving objects: 100% <span class="o">(</span>19032/19032<span class="o">)</span>, 12.33 MiB | 15.21 MiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>2022/2022<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
root@284b243a39ec:~# <span class="nb">cd</span> ~/spack
</pre></table></code></div></div><p>初始化，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# <span class="nb">.</span> share/spack/setup-env.sh
root@284b243a39ec:~/spack# spack compiler find
</pre></table></code></div></div><h1 id="上手">上手</h1><p><code class="language-plaintext highlighter-rouge">spack list</code>查看所有可用的包，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack list
</pre></table></code></div></div><p><a href="https://github.com/icinfra/icinfra-artifacts-0001/assets/32032219/e3c28374-ff18-485f-ae6a-abb367890a02" class="popup img-link shimmer"><img src="https://github.com/icinfra/icinfra-artifacts-0001/assets/32032219/e3c28374-ff18-485f-ae6a-abb367890a02" alt="image" loading="lazy"></a></p><p><code class="language-plaintext highlighter-rouge">spack list</code>支持查询语句</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack list pytho<span class="k">*</span> <span class="c">#前缀匹配查询</span>
python
<span class="o">==&gt;</span> 1 packages
root@284b243a39ec:~/spack# spack list pytho <span class="c">#模糊匹配查询</span>
py-antlr4-python3-runtime    py-ipython                 py-mysql-connector-python  py-python-constraint  py-python-engineio    py-python-jose            py-python-louvain        py-python-memcached  py-python-socketio     py-python3-openid    py-systemd-python
py-avro-python3              py-ipython-cluster-helper  py-openslide-python        py-python-crfsuite    py-python-fmask       py-python-json-logger     py-python-lsp-jsonrpc    py-python-multipart  py-python-sotools      py-python3-xlib      py-types-python-dateutil
py-biopython                 py-ipython-genutils        py-psij-python             py-python-daemon      py-python-fsutil      py-python-keystoneclient  py-python-lsp-server     py-python-oauth2     py-python-subunit      py-pythonqwt         py-wxpython
py-bx-python                 py-kb-python               py-python-benedict         py-python-dateutil    py-python-gitlab      py-python-ldap            py-python-lzo            py-python-picard     py-python-swiftclient  py-pythonsollya      python
py-dnspython                 py-meson-python            py-python-bioformats       py-python-docs-theme  py-python-igraph      py-python-levenshtein     py-python-magic          py-python-ptrace     py-python-utils        py-saga-python       r-findpython
py-gitpython                 py-mkdocstrings-python     py-python-box              py-python-dotenv      py-python-javabridge  py-python-libsbml         py-python-mapnik         py-python-rapidjson  py-python-xlib         py-scientificpython  xtensor-python
py-google-api-python-client  py-mmtf-python             py-python-certifi-win32    py-python-editor      py-python-jenkins     py-python-logstash        py-python-markdown-math  py-python-slugify    py-python-xmp-toolkit  py-spython
<span class="o">==&gt;</span> 76 packages
</pre></table></code></div></div><p>安装一个包，命名<code class="language-plaintext highlighter-rouge">spack install &lt;package_name&gt;</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>zlib
<span class="o">==&gt;</span> Installing zlib-1.2.13-ivmy4r5hq6uijii4yspbffl2dutqdxgb
<span class="o">==&gt;</span> No binary <span class="k">for </span>zlib-1.2.13-ivmy4r5hq6uijii4yspbffl2dutqdxgb found: installing from <span class="nb">source</span>
<span class="o">==&gt;</span> Using cached archive: /root/spack/var/spack/cache/_source-cache/archive/b3/b3a24de97a8fdbc835b9833169501030b8977031bcb54b3b3ac13740f846ab30.tar.gz
<span class="o">==&gt;</span> No patches needed <span class="k">for </span>zlib
<span class="o">==&gt;</span> zlib: Executing phase: <span class="s1">'edit'</span>
<span class="o">==&gt;</span> zlib: Executing phase: <span class="s1">'build'</span>
<span class="o">==&gt;</span> zlib: Executing phase: <span class="s1">'install'</span>
<span class="o">==&gt;</span> zlib: Successfully installed zlib-1.2.13-ivmy4r5hq6uijii4yspbffl2dutqdxgb
  Stage: 0.04s.  Edit: 0.38s.  Build: 0.61s.  Install: 0.05s.  Post-install: 0.02s.  Total: 1.12s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/zlib-1.2.13-ivmy4r5hq6uijii4yspbffl2dutqdxgb
</pre></table></code></div></div><p>Spack安装包时，支持从源码安装，或者从二进制缓存安装。二进制缓存的安全，由GPG签名保证。</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack mirror add tutorial /mirror
root@284b243a39ec:~/spack# spack buildcache keys <span class="nt">--install</span> <span class="nt">--trust</span>
<span class="o">==&gt;</span> Fetching file:///mirror/build_cache/_pgp/0ACDCFDA91DB974A68C3DDC2F85815B32355CB19.pub
gpg: key F85815B32355CB19: public key <span class="s2">"e4s-uo-spack-01"</span> imported
gpg: Total number processed: 1
gpg:		   imported: 1
gpg: inserting ownertrust of 6
<span class="o">==&gt;</span> Fetching file:///mirror/build_cache/_pgp/2C8DD3224EF3573A42BD221FA8E0CA3C1C2ADA2F.pub
gpg: key A8E0CA3C1C2ADA2F: 5 signatures not checked due to missing keys
gpg: key A8E0CA3C1C2ADA2F: public key <span class="s2">"Spack Project Official Binaries &lt;maintainers@spack.io&gt;"</span> imported
gpg: Total number processed: 1
gpg:		   imported: 1
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:	1  signed:   0	trust: 0-, 0q, 0n, 0m, 0f, 1u
gpg: inserting ownertrust of 6
<span class="o">==&gt;</span> Fetching file:///mirror/build_cache/_pgp/78F3726939CA1B94893B66E8BC86F6FB94429164.pub
gpg: key A8E0CA3C1C2ADA2F: 7 signatures not checked due to missing keys
gpg: key A8E0CA3C1C2ADA2F: <span class="s2">"Spack Project Official Binaries &lt;maintainers@spack.io&gt;"</span> 3 new signatures
gpg: key A8E0CA3C1C2ADA2F: <span class="s2">"Spack Project Official Binaries &lt;maintainers@spack.io&gt;"</span> 1 new subkey
gpg: Total number processed: 1
gpg:		new subkeys: 1
gpg:	     new signatures: 3
gpg: marginals needed: 3  completes needed: 1  trust model: pgp
gpg: depth: 0  valid:	2  signed:   0	trust: 0-, 0q, 0n, 0m, 0f, 2u
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>spack <span class="nb">install </span>zlib %clang
<span class="o">==&gt;</span> Installing zlib-1.2.13-gephbceg3rl2e77o46xyzlk5e4kd3gt3
<span class="o">==&gt;</span> Fetching file:///mirror/build_cache/linux-ubuntu22.04-x86_64_v3-clang-14.0.0-zlib-1.2.13-gephbceg3rl2e77o46xyzlk5e4kd3gt3.spec.json.sig
<span class="o">==&gt;</span> Fetching file:///mirror/build_cache/linux-ubuntu22.04-x86_64_v3/clang-14.0.0/zlib-1.2.13/linux-ubuntu22.04-x86_64_v3-clang-14.0.0-zlib-1.2.13-gephbceg3rl2e77o46xyzlk5e4kd3gt3.spack
<span class="o">==&gt;</span> Extracting zlib-1.2.13-gephbceg3rl2e77o46xyzlk5e4kd3gt3 from binary cache
<span class="o">==&gt;</span> zlib: Successfully installed zlib-1.2.13-gephbceg3rl2e77o46xyzlk5e4kd3gt3
  Search: 0.00s.  Fetch: 0.11s.  Install: 0.02s.  Total: 0.13s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-x86_64_v3/clang-14.0.0/zlib-1.2.13-gephbceg3rl2e77o46xyzlk5e4kd3gt3
</pre></table></code></div></div><p>在运行安装命令前，可以先查看有哪些版本，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack versions zlib
<span class="o">==&gt;</span> Safe versions <span class="o">(</span>already checksummed<span class="o">)</span>:
  1.2.13  1.2.12  1.2.11  1.2.8  1.2.3
<span class="o">==&gt;</span> Remote versions <span class="o">(</span>not yet checksummed<span class="o">)</span>:
  1.3     1.2.9    1.2.7.2  1.2.7    1.2.6    1.2.5.2  1.2.5    1.2.4.4  1.2.4.2  1.2.4    1.2.3.8  1.2.3.6  1.2.3.4  1.2.3.2  1.2.2.4  1.2.2.2  1.2.2    1.2.1.1  1.2.0.8  1.2.0.6  1.2.0.4  1.2.0.2  1.2.0  1.1.3  1.1.1  1.0.9  1.0.7  1.0.5  1.0.2  1.0-pre  0.95  0.93  0.91  0.71  0.8
  1.2.10  1.2.7.3  1.2.7.1  1.2.6.1  1.2.5.3  1.2.5.1  1.2.4.5  1.2.4.3  1.2.4.1  1.2.3.9  1.2.3.7  1.2.3.5  1.2.3.3  1.2.3.1  1.2.2.3  1.2.2.1  1.2.1.2  1.2.1    1.2.0.7  1.2.0.5  1.2.0.3  1.2.0.1  1.1.4  1.1.2  1.1.0  1.0.8  1.0.6  1.0.4  1.0.1  0.99     0.94  0.92  0.79  0.9
</pre></table></code></div></div><p>安装时，可以传编译器flags，如cppflags, cflags, cxxflags, fflags, ldflags, 与 ldlibs 参数。</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>zlib@1.2.8 <span class="nv">cflags</span><span class="o">=</span><span class="nt">-O3</span>
<span class="o">==&gt;</span> Warning: using <span class="s2">"zlib@1.2.8"</span> which is a deprecated version
<span class="o">==&gt;</span> Installing zlib-1.2.8-5o535gi4wwtrfcb3jcilmuelp57hnyxq
<span class="o">==&gt;</span> No binary <span class="k">for </span>zlib-1.2.8-5o535gi4wwtrfcb3jcilmuelp57hnyxq found: installing from <span class="nb">source</span>
<span class="o">==&gt;</span> Warning: zlib@1.2.8 is deprecated and may be removed <span class="k">in </span>a future Spack release.
<span class="o">==&gt;</span>   Fetch anyway? <span class="o">[</span>y/N] y
<span class="o">==&gt;</span> Fetching https://mirror.spack.io/_source-cache/archive/36/36658cb768a54c1d4dec43c3116c27ed893e88b02ecfcb44f2166f9c0b7f2a0d.tar.gz
<span class="o">==&gt;</span> No patches needed <span class="k">for </span>zlib
<span class="o">==&gt;</span> zlib: Executing phase: <span class="s1">'edit'</span>
<span class="o">==&gt;</span> zlib: Executing phase: <span class="s1">'build'</span>
<span class="o">==&gt;</span> zlib: Executing phase: <span class="s1">'install'</span>
<span class="o">==&gt;</span> zlib: Successfully installed zlib-1.2.8-5o535gi4wwtrfcb3jcilmuelp57hnyxq
  Stage: 44.96s.  Edit: 0.38s.  Build: 0.56s.  Install: 0.07s.  Post-install: 0.02s.  Total: 46.01s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/zlib-1.2.8-5o535gi4wwtrfcb3jcilmuelp57hnyxq
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">spack find</code>查看已安装的包，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack find
<span class="nt">--</span> linux-ubuntu22.04-cascadelake / clang@14.0.0 <span class="nt">-----------------</span>
zlib@1.2.12  zlib@1.2.13

<span class="nt">--</span> linux-ubuntu22.04-cascadelake / gcc@11.4.0 <span class="nt">-------------------</span>
zlib@1.2.8  zlib@1.2.13
<span class="o">==&gt;</span> 4 installed packages
root@284b243a39ec:~/spack# spack find <span class="nt">-lf</span>
<span class="nt">--</span> linux-ubuntu22.04-cascadelake / clang@14.0.0 <span class="nt">-----------------</span>
phqllhi zlib@1.2.12%clang   r5taitb zlib@1.2.13%clang 

<span class="nt">--</span> linux-ubuntu22.04-cascadelake / gcc@11.4.0 <span class="nt">-------------------</span>
5o535gi zlib@1.2.8%gcc  <span class="nv">cflags</span><span class="o">=</span><span class="s2">"-O3"</span>   ivmy4r5 zlib@1.2.13%gcc 
<span class="o">==&gt;</span> 4 installed packages
</pre></table></code></div></div><p>Spack为每个spec都生成一个hash，任何不同版本组合都生成唯一的hash。</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>tcl
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/zlib-1.2.13-ivmy4r5hq6uijii4yspbffl2dutqdxgb
<span class="o">==&gt;</span> Installing tcl-8.6.12-m2wnkqeddps4xf5oyrxqd6i3lrvokfwp
<span class="o">==&gt;</span> No binary <span class="k">for </span>tcl-8.6.12-m2wnkqeddps4xf5oyrxqd6i3lrvokfwp found: installing from <span class="nb">source</span>
<span class="o">==&gt;</span> Fetching https://mirror.spack.io/_source-cache/archive/26/26c995dd0f167e48b11961d891ee555f680c175f7173ff8cb829f4ebcde4c1a6.tar.gz
<span class="o">==&gt;</span> No patches needed <span class="k">for </span>tcl
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'autoreconf'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'configure'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'build'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'install'</span>
<span class="o">==&gt;</span> tcl: Successfully installed tcl-8.6.12-m2wnkqeddps4xf5oyrxqd6i3lrvokfwp
  Stage: 14.43s.  Autoreconf: 0.00s.  Configure: 5.85s.  Build: 1m 2.43s.  Install: 3.53s.  Post-install: 0.59s.  Total: 1m 26.86s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/tcl-8.6.12-m2wnkqeddps4xf5oyrxqd6i3lrvokfwp
</pre></table></code></div></div><p>使用<code class="language-plaintext highlighter-rouge">^</code>指定依赖</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>tcl ^zlib@1.2.13 %clang
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/clang-14.0.0/zlib-1.2.13-r5taitbmvh5nzn2jqjo2f2mignhvrabe
<span class="o">==&gt;</span> Installing tcl-8.6.12-lgob6rq7jo5q3dyd2qfhyrs3nk6ggpqe
<span class="o">==&gt;</span> No binary <span class="k">for </span>tcl-8.6.12-lgob6rq7jo5q3dyd2qfhyrs3nk6ggpqe found: installing from <span class="nb">source</span>
<span class="o">==&gt;</span> Using cached archive: /root/spack/var/spack/cache/_source-cache/archive/26/26c995dd0f167e48b11961d891ee555f680c175f7173ff8cb829f4ebcde4c1a6.tar.gz
<span class="o">==&gt;</span> No patches needed <span class="k">for </span>tcl
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'autoreconf'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'configure'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'build'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'install'</span>
<span class="o">==&gt;</span> tcl: Successfully installed tcl-8.6.12-lgob6rq7jo5q3dyd2qfhyrs3nk6ggpqe
  Stage: 0.36s.  Autoreconf: 0.00s.  Configure: 10.13s.  Build: 1m 13.37s.  Install: 3.34s.  Post-install: 0.58s.  Total: 1m 27.82s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/clang-14.0.0/tcl-8.6.12-lgob6rq7jo5q3dyd2qfhyrs3nk6ggpqe
</pre></table></code></div></div><p>使用<code class="language-plaintext highlighter-rouge">^/5o5</code>指定依赖的hash。如上所示，其中5o5是zlib@1.2.8%gcc的hash。</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>tcl ^/5o5
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/zlib-1.2.8-5o535gi4wwtrfcb3jcilmuelp57hnyxq
<span class="o">==&gt;</span> Installing tcl-8.6.12-o6wvao34ytjgbpy2kpf63x4c34wn45ub
<span class="o">==&gt;</span> No binary <span class="k">for </span>tcl-8.6.12-o6wvao34ytjgbpy2kpf63x4c34wn45ub found: installing from <span class="nb">source</span>
<span class="o">==&gt;</span> Using cached archive: /root/spack/var/spack/cache/_source-cache/archive/26/26c995dd0f167e48b11961d891ee555f680c175f7173ff8cb829f4ebcde4c1a6.tar.gz
<span class="o">==&gt;</span> No patches needed <span class="k">for </span>tcl
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'autoreconf'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'configure'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'build'</span>
<span class="o">==&gt;</span> tcl: Executing phase: <span class="s1">'install'</span>
<span class="o">==&gt;</span> tcl: Successfully installed tcl-8.6.12-o6wvao34ytjgbpy2kpf63x4c34wn45ub
  Stage: 0.35s.  Autoreconf: 0.00s.  Configure: 6.08s.  Build: 1m 1.70s.  Install: 3.45s.  Post-install: 0.59s.  Total: 1m 12.21s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/tcl-8.6.12-o6wvao34ytjgbpy2kpf63x4c34wn45ub
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">spack find</code>还支持<code class="language-plaintext highlighter-rouge">-d</code>，用来显示依赖关系。</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack find <span class="nt">-ldf</span>
<span class="nt">--</span> linux-ubuntu22.04-cascadelake / clang@14.0.0 <span class="nt">-----------------</span>
lgob6rq tcl@8.6.12%clang 
r5taitb     zlib@1.2.13%clang 

phqllhi zlib@1.2.12%clang 

r5taitb zlib@1.2.13%clang 


<span class="nt">--</span> linux-ubuntu22.04-cascadelake / gcc@11.4.0 <span class="nt">-------------------</span>
o6wvao3 tcl@8.6.12%gcc 
5o535gi     zlib@1.2.8%gcc  <span class="nv">cflags</span><span class="o">=</span><span class="s2">"-O3"</span> 

m2wnkqe tcl@8.6.12%gcc 
ivmy4r5     zlib@1.2.13%gcc 

5o535gi zlib@1.2.8%gcc  <span class="nv">cflags</span><span class="o">=</span><span class="s2">"-O3"</span> 

ivmy4r5 zlib@1.2.13%gcc 

<span class="o">==&gt;</span> 7 installed packages
</pre></table></code></div></div><p>我们来安装一个更复杂的包——HDF5，默认情况下，会将MPI依赖也装上。</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>hdf5
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/libpciaccess-0.17-pykx2euy2awtgyou2nnsjl2s6hi4n646
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/libiconv-1.17-yodoqmhmvqbqvjzl3s6snnatz6trv7iy
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/xz-5.4.1-dzgxjank6ou2hybibf5ub262lgc2lorn
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/zlib-1.2.13-ivmy4r5hq6uijii4yspbffl2dutqdxgb
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/ncurses-6.4-ujngusmjurwe2fa7l3b6kvt73gabtuor
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/numactl-2.0.14-r22sabf66foyohnzrm2vhslqhyvzaodc
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/bzip2-1.0.8-ddoyjf47vjlyagfc22epabwym5pymdr7
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/zstd-1.5.5-5e3alsszldfqzfm4bln3x2bxo63lgc5h
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/libxcrypt-4.4.33-gei6nykcbdwqnwkbtaapysokbdy5hsa5
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/pkgconf-1.9.5-sxbb6ve36mznc2trrpk4llouoi47yqlm
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/pigz-2.7-5gemoganu6n6ps7aca4llw5txrxgwcm7
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/openssl-1.1.1t-vmachqinwttmfsngz56nzjlsdxpvp7ki
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/libedit-3.1-20210216-d7fgamjkvusfpwqhdevl5u3ld2ajwelz
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/libxml2-2.10.3-5mmkszwox2ca75c274cebzp7yizhvant
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/tar-1.34-tfgqkhebvyigwree5sh4jxtt2r6ebkhn
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/libevent-2.1.12-zt3qad4mu4mlsfmedkakxw7ue4ekrudc
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/hwloc-2.9.1-fcfzcph73hlkt23vthevpninsi7jbfdp
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/gettext-0.21.1-y3smi3ultsqlwsrwzcykwzl52h4eekhg
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/pmix-4.2.3-h55tf5zun6v6kxuszej6imea7sfb7lku
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/krb5-1.20.1-imoj7v4sveupl2komhnb655d3jjxeyez
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/openssh-9.3p1-pi6fj3d4bnbsvdzjygatwmeppme2e57o
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/openmpi-4.1.5-z2lpbjfjf72tikfaxfuq7keby327rang
<span class="o">==&gt;</span> Installing hdf5-1.14.1-2-gqyhwfo3iyea3sdekxcolo5qrnnuzlqn
<span class="o">==&gt;</span> No binary <span class="k">for </span>hdf5-1.14.1-2-gqyhwfo3iyea3sdekxcolo5qrnnuzlqn found: installing from <span class="nb">source</span>
<span class="o">==&gt;</span> Fetching https://mirror.spack.io/_source-cache/archive/cb/cbe93f275d5231df28ced9549253793e40cd2b555e3d288df09d7b89a9967b07.tar.gz
<span class="o">==&gt;</span> Ran patch<span class="o">()</span> <span class="k">for </span>hdf5
<span class="o">==&gt;</span> hdf5: Executing phase: <span class="s1">'cmake'</span>
<span class="o">==&gt;</span> hdf5: Executing phase: <span class="s1">'build'</span>
<span class="o">==&gt;</span> hdf5: Executing phase: <span class="s1">'install'</span>
<span class="o">==&gt;</span> hdf5: Successfully installed hdf5-1.14.1-2-gqyhwfo3iyea3sdekxcolo5qrnnuzlqn
  Stage: 31.03s.  Cmake: 11.47s.  Build: 30.78s.  Install: 0.90s.  Post-install: 0.20s.  Total: 1m 14.55s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/hdf5-1.14.1-2-gqyhwfo3iyea3sdekxcolo5qrnnuzlqn
</pre></table></code></div></div><p>Spack包也有build选项，通过+或~/-</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>hdf5~mpi
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/ncurses-6.4-ujngusmjurwe2fa7l3b6kvt73gabtuor
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/zlib-1.2.13-ivmy4r5hq6uijii4yspbffl2dutqdxgb
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/gmake-4.4.1-264topq36ww6abmwthbd7pouu65v7nwm
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/pkgconf-1.9.5-sxbb6ve36mznc2trrpk4llouoi47yqlm
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/openssl-1.1.1t-vmachqinwttmfsngz56nzjlsdxpvp7ki
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/cmake-3.26.3-ttvpnusqvmowfgfwiwil7dgkmkjaiqp5
<span class="o">==&gt;</span> Installing hdf5-1.14.1-2-thweeqbqmd7uqugx6iswe56zarcgg554
<span class="o">==&gt;</span> No binary <span class="k">for </span>hdf5-1.14.1-2-thweeqbqmd7uqugx6iswe56zarcgg554 found: installing from <span class="nb">source</span>
<span class="o">==&gt;</span> Using cached archive: /root/spack/var/spack/cache/_source-cache/archive/cb/cbe93f275d5231df28ced9549253793e40cd2b555e3d288df09d7b89a9967b07.tar.gz
<span class="o">==&gt;</span> Ran patch<span class="o">()</span> <span class="k">for </span>hdf5
<span class="o">==&gt;</span> hdf5: Executing phase: <span class="s1">'cmake'</span>
<span class="o">==&gt;</span> hdf5: Executing phase: <span class="s1">'build'</span>
<span class="o">==&gt;</span> hdf5: Executing phase: <span class="s1">'install'</span>
<span class="o">==&gt;</span> hdf5: Successfully installed hdf5-1.14.1-2-thweeqbqmd7uqugx6iswe56zarcgg554
  Stage: 0.83s.  Cmake: 10.69s.  Build: 27.12s.  Install: 0.88s.  Post-install: 0.18s.  Total: 39.84s
<span class="o">[</span>+] /root/spack/opt/spack/linux-ubuntu22.04-cascadelake/gcc-11.4.0/hdf5-1.14.1-2-thweeqbqmd7uqugx6iswe56zarcgg554
</pre></table></code></div></div><p>Spack还可以通过^来指定依赖</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>root@284b243a39ec:~/spack# spack <span class="nb">install </span>hdf5+hl+mpi ^mpich
</pre></table></code></div></div><p>Spack可以打印依赖的单向无环图(DAG)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>spack graph hdf5+hl+mpi ^mpich
</pre></table></code></div></div><p>再安装一个更复杂的，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>spack <span class="nb">install </span>trilinos
</pre></table></code></div></div><p>这个直接依赖有23个，依赖又有自己的依赖。经验丰富的用户可能也需要花几天、几周来完成，而spack一条命令几秒钟搞定。</p><p>DAG输出到PDF文件，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>spack graph <span class="nt">--dot</span> trilinos | dot <span class="nt">-Tpdf</span> <span class="o">&gt;</span> trilinos_graph.pdf
</pre></table></code></div></div><p>uninstall包</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>spack uninstall
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">spack find</code>也支持高级查询，包括</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>spack find ^mpich <span class="c">#查询依赖mpich的包</span>
spack find <span class="nv">cflags</span><span class="o">=</span><span class="nt">-O3</span> <span class="c">#查询带这个编译选项的</span>
</pre></table></code></div></div><p>将spack安装的gcc加入spack编译器列表里，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>spack compiler add <span class="s2">"</span><span class="si">$(</span>spack location <span class="nt">-i</span> gcc@12<span class="si">)</span><span class="s2">"</span>
</pre></table></code></div></div><p>将gcc编译器移出spack编译器列表，</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>spack compiler remove gcc@12
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/icenv/">icenv</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/spack/" class="post-tag no-text-decoration" >spack</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Spack%E6%95%99%E7%A8%8B%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89%20-%20IC%20Infra&url=https%3A%2F%2Ficinfra.cn%2Fposts%2Fspack-tutorial-basics%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Spack%E6%95%99%E7%A8%8B%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89%20-%20IC%20Infra&u=https%3A%2F%2Ficinfra.cn%2Fposts%2Fspack-tutorial-basics%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Ficinfra.cn%2Fposts%2Fspack-tutorial-basics%2F&text=Spack%E6%95%99%E7%A8%8B%EF%BC%88%E5%9F%BA%E7%A1%80%EF%BC%89%20-%20IC%20Infra" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div><div class="payment-info mt-5 text-center"><h4>支持创作者</h4><p>如果本文帮助到你，可以通过以下收款码支持我：</p><a href="https://cdn.jsdelivr.net/gh/icinfra/icinfra-artifacts-0001@artifacts/img/qrcode.jpg" class="popup img-link img-fluid shimmer"><img src="https://cdn.jsdelivr.net/gh/icinfra/icinfra-artifacts-0001@artifacts/img/qrcode.jpg" alt="收款码" style="max-width: 300px;" loading="lazy"></a><p>感谢你的支持！</p></div></div></article><script src="https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js"></script> <script> document.addEventListener('DOMContentLoaded', function() { mermaid.initialize({ startOnLoad: true, theme: "default" }); // 既支持 language-mermaid 也支持 mermaid 类 window.mermaid.init(undefined, document.querySelectorAll('.language-mermaid, .mermaid')); }); </script></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/toggle-layers-visibility/">Toggle Layers Visibility</a><li class="text-truncate lh-lg"> <a href="/posts/cadence-eda-downloader-user-guide/">Cadence EDA Downloader User Guide </a><li class="text-truncate lh-lg"> <a href="/posts/privacy-policy-for-cadence-eda-downloader/">Privacy Policy for Cadence EDA Downloader</a><li class="text-truncate lh-lg"> <a href="/posts/cadence-support-downloader-privacy-policy/">Cadence Support Downloader: Privacy Policy</a><li class="text-truncate lh-lg"> <a href="/posts/Lumerical-job-scheduler-integration-Slurm-Torque-LSF-SGE/">Lumerical job scheduler integration (Slurm, Torque, LSF, SGE) </a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/formatting/">formatting</a> <a class="post-tag btn btn-outline-primary" href="/tags/post/">post</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/analog/">analog</a> <a class="post-tag btn btn-outline-primary" href="/tags/ipa/">ipa</a> <a class="post-tag btn btn-outline-primary" href="/tags/links/">links</a> <a class="post-tag btn btn-outline-primary" href="/tags/lsf/">lsf</a> <a class="post-tag btn btn-outline-primary" href="/tags/eda/">eda</a> <a class="post-tag btn btn-outline-primary" href="/tags/license/">license</a></div></section></div></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/how-to-add-compiler-for-spack/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1712625120" data-df="ll" > Apr 9, 2024 </time><h4 class="pt-0 my-2">给spack加编译器</h4><div class="text-muted"><p>参考资料 https://spack.readthedocs.io/en/latest/getting_started.html#spack-compiler-add</p></div></div></a></article><article class="col"> <a href="/posts/spack-bootstrap-in-air-gapped-system/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1705806900" data-df="ll" > Jan 21, 2024 </time><h4 class="pt-0 my-2">spack bootstrap in air-gapped system</h4><div class="text-muted"><p>背景 首次使用spack时，虽然将gmake-4.4.1.tar.gz包下载至mirror目录，但还是提示如下： 1 2 3 4 spack install gcc@13.2.0 +binutils ==&amp;gt; Installing gmake-4.4.1-bun3eynjvtrgzylwfldooydmcbtgsavx [1/2] ==&amp;gt; No binary for gmake-4...</p></div></div></a></article><article class="col"> <a href="/posts/chaining-spack-installations/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1698404400" data-df="ll" > Oct 27, 2023 </time><h4 class="pt-0 my-2">将已有的spack安装目录串起来，实现复用</h4><div class="text-muted"><p>根据这里 https://spack.readthedocs.io/en/latest/chain.html 介绍，可以将一个或多个已存在的spack安装目录串起来，实现复用。 这在spack版本升级时非常有用，spack在不定期地迭代更新，但是每一个spack版本默认将包安装在其 opt/spack/ 目录下，如果想升级版本时则无法利用旧版本已安装的那些包。利用该特性，可以实现对旧版本sp...</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/meetings/" class="btn btn-outline-primary" aria-label="Older" ><p>会议有感</p></a> <a href="/posts/giscus-comments/" class="btn btn-outline-primary" aria-label="Newer" ><p>a post with giscus comments</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://github.com/wanlinwang">wanlinwang</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Rights reserved.</span></p><p></p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/formatting/">formatting</a> <a class="post-tag btn btn-outline-primary" href="/tags/post/">post</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/linux/">linux</a> <a class="post-tag btn btn-outline-primary" href="/tags/analog/">analog</a> <a class="post-tag btn btn-outline-primary" href="/tags/ipa/">ipa</a> <a class="post-tag btn btn-outline-primary" href="/tags/links/">links</a> <a class="post-tag btn btn-outline-primary" href="/tags/lsf/">lsf</a> <a class="post-tag btn btn-outline-primary" href="/tags/eda/">eda</a> <a class="post-tag btn btn-outline-primary" href="/tags/license/">license</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> (function () { const themeMapper = Theme.getThemeMapper('light', 'dark_dimmed'); const initTheme = themeMapper[Theme.visualState]; let lang = 'en';if (lang.length > 2 && !lang.startsWith('zh')) { lang = lang.slice(0, 2); } let giscusAttributes = { src: 'https://giscus.app/client.js', 'data-repo': 'icinfra/icinfra-discussions', 'data-repo-id': 'R_kgDOOURp_w', 'data-category': 'Q&A', 'data-category-id': 'DIC_kwDOOURp_84Coy9P', 'data-mapping': 'pathname', 'data-strict' : '1', 'data-reactions-enabled': '1', 'data-emit-metadata': '0', 'data-theme': initTheme, 'data-input-position': 'bottom', 'data-lang': lang, 'data-loading': 'lazy', crossorigin: 'anonymous', async: '' }; let giscusNode = document.createElement('script'); Object.entries(giscusAttributes).forEach(([key, value]) => giscusNode.setAttribute(key, value) ); const $footer = document.querySelector('footer'); $footer.insertAdjacentElement("beforebegin", giscusNode); addEventListener('message', (event) => { if (event.source === window && event.data && event.data.id === Theme.ID) { const newTheme = themeMapper[Theme.visualState]; const message = { setConfig: { theme: newTheme } }; const giscus = document.getElementsByClassName('giscus-frame')[0].contentWindow; giscus.postMessage({ giscus: message }, 'https://giscus.app'); } }); })(); </script> <script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
